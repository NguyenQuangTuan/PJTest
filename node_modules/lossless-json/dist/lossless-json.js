!function(r,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(r.LosslessJSON={})}(this,function(r){"use strict";var n=!0;function e(r){return r&&void 0!==r.circularRefs&&null!==r.circularRefs&&(n=!0===r.circularRefs),{circularRefs:n}}var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},o=function(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")},i=function(){function r(r,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(r,t.key,t)}}return function(n,e,t){return e&&r(n.prototype,e),t&&r(n,t),n}}(),f=function(){function r(n){o(this,r),this.value=function r(n){if("string"==typeof n){if(!function(r){return/^-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?$/.test(r)}(n))throw new Error('Invalid number (value: "'+n+'")');return n}if("number"==typeof n){if(u(n+"").length>15)throw new Error("Invalid number: contains more than 15 digits (value: "+n+")");if(isNaN(n))throw new Error("Invalid number: NaN");if(!isFinite(n))throw new Error("Invalid number: Infinity");return n+""}return r(n&&n.valueOf())}(n),this.type="LosslessNumber",this.isLosslessNumber=!0}return i(r,[{key:"valueOf",value:function(){var r=parseFloat(this.value),n=u(this.value);if(n.length>15)throw new Error("Cannot convert to number: number would be truncated (value: "+this.value+")");if(!isFinite(r))throw new Error("Cannot convert to number: number would overflow (value: "+this.value+")");if(Math.abs(r)<Number.MIN_VALUE&&!/^0*$/.test(n))throw new Error("Cannot convert to number: number would underflow (value: "+this.value+")");return r}},{key:"toString",value:function(){return this.value}}]),r}();function u(r){return("string"!=typeof r?r+"":r).replace(/^-/,"").replace(/e.*$/,"").replace(/^0\.?0*|\./,"")}function a(r,n,e,o){return Array.isArray(e)?o.call(r,n,function(r,n){for(var e=[],t=0;t<r.length;t++)e[t]=a(r,t+"",r[t],n);return e}(e,o)):e&&"object"===(void 0===e?"undefined":t(e))&&!e.isLosslessNumber?o.call(r,n,function(r,n){var e={};for(var t in r)r.hasOwnProperty(t)&&(e[t]=a(r,t,r[t],n));return e}(e,o)):o.call(r,n,e)}function c(r){return encodeURIComponent(r.replace(/\//g,"~1").replace(/~/g,"~0"))}function l(r){return decodeURIComponent(r).replace(/~1/g,"/").replace(/~0/g,"~")}function s(r){return"#/"+r.map(c).join("/")}var v={NULL:0,DELIMITER:1,NUMBER:2,STRING:3,SYMBOL:4,UNKNOWN:5},h={"":!0,"{":!0,"}":!0,"[":!0,"]":!0,":":!0,",":!0},d={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},p="",y=0,b="",g="",m=v.NULL,w=[],I=[];function E(){y++,b=p.charAt(y)}function N(){for(m=v.NULL,g="";" "===b||"\t"===b||"\n"===b||"\r"===b;)E();if(h[b])return m=v.DELIMITER,g=b,void E();if(S(b)||"-"===b){if(m=v.NUMBER,"-"===b){if(g+=b,E(),!S(b))throw M("Invalid number, digit expected",y)}else"0"===b&&(g+=b,E());for(;S(b);)g+=b,E();if("."===b){if(g+=b,E(),!S(b))throw M("Invalid number, digit expected",y);for(;S(b);)g+=b,E()}if("e"===b||"E"===b){if(g+=b,E(),"+"!==b&&"-"!==b||(g+=b,E()),!S(b))throw M("Invalid number, digit expected",y);for(;S(b);)g+=b,E()}}else if('"'!==b){if(!L(b)){for(m=v.UNKNOWN;""!==b;)g+=b,E();throw M('Syntax error in part "'+g+'"')}for(m=v.SYMBOL;L(b);)g+=b,E()}else{for(m=v.STRING,E();""!==b&&'"'!==b;)if("\\"===b){E();var r=d[b];if(void 0!==r)g+=r,E();else{if("u"!==b)throw M('Invalid escape character "\\'+b+'"',y);E();for(var n="",e=0;e<4;e++){if(!R(b))throw M("Invalid unicode character");n+=b,E()}g+=String.fromCharCode(parseInt(n,16))}}else g+=b,E();if('"'!==b)throw M("End of string expected");E()}}function L(r){return/^[a-zA-Z_]/.test(r)}function R(r){return/^[0-9a-fA-F]/.test(r)}function S(r){return r>="0"&&r<="9"}function M(r,n){void 0===n&&(n=y-g.length);var e=new SyntaxError(r+" (char "+n+")");return e.char=n,e}function O(){if(m===v.DELIMITER&&"{"===g){N();var r=void 0,n={};if(m===v.DELIMITER&&"}"===g)return N(),n;var t=I.length;for(I[t]=n;;){if(m!==v.STRING)throw M("Object key expected");if(r=g,N(),m!==v.DELIMITER||":"!==g)throw M("Colon expected");if(N(),w[t]=r,n[r]=O(),m!==v.DELIMITER||","!==g)break;N()}if(m!==v.DELIMITER||"}"!==g)throw M('Comma or end of object "}" expected');return N(),function(r){return"string"==typeof r.$ref&&1===Object.keys(r).length}(n)?function(r){if(!e().circularRefs)return r;for(var n=function(r){var n=r.split("/").map(l);if("#"!==n.shift())throw SyntaxError("Cannot parse JSON Pointer: no valid URI fragment");return""===n[n.length-1]&&n.pop(),n}(r.$ref),t=0;t<n.length;t++)if(n[t]!==w[t])throw new Error('Invalid circular reference "'+r.$ref+'"');return I[n.length]}(n):(I.length=t,w.length=t,n)}return function(){if(m===v.DELIMITER&&"["===g){N();var r=[];if(m===v.DELIMITER&&"]"===g)return N(),r;var n=I.length;for(I[n]=r;w[n]=r.length+"",r.push(O()),m===v.DELIMITER&&","===g;)N();if(m!==v.DELIMITER||"]"!==g)throw M('Comma or end of array "]" expected');return N(),I.length=n,w.length=n,r}return function(){if(m===v.STRING){var r=g;return N(),r}return function(){if(m===v.NUMBER){var r=new f(g);return N(),r}return function(){if(m===v.SYMBOL){if("true"===g)return N(),!0;if("false"===g)return N(),!1;if("null"===g)return N(),null;throw M('Unknown symbol "'+g+'"')}return function(){throw M(""===g?"Unexpected end of json string":"Value expected")}()}()}()}()}()}var x={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},T=[],U=[];function C(r,n,e){U=[],T=[];var t="function"==typeof n?n.call({"":r},"",r):r,o=void 0;return"number"==typeof e?e>10?o=$(" ",10):e>=1&&(o=$(" ",e)):"string"==typeof e&&""!==e&&(o=e),D(t,n,o,"")}function D(r,n,e,o){if(!0===r||!1===r||r instanceof Boolean)return r+"";if(null===r)return"null";if("number"==typeof r||r instanceof Number)return isNaN(r)||!isFinite(r)?"null":r+"";if(r&&r.isLosslessNumber)return r.value;if("string"==typeof r||r instanceof String){for(var i="",f=0;f<r.length;f++){var u=r[f];i+=x[u]||u}return'"'+i+'"'}return r instanceof Date?'"'+r.toISOString()+'"':Array.isArray(r)?function(r,n,e,t){var o=e?t+e:void 0,i=e?"[\n":"[";if(j(r))return k(r,n,e,t);var f=U.length;U[f]=r;for(var u=0;u<r.length;u++){var a=u+"",c="function"==typeof n?n.call(r,a,r[u]):r[u];e&&(i+=o),void 0!==c&&"function"!=typeof c?(T[f]=a,i+=D(c,n,e,o)):i+="null",u<r.length-1&&(i+=e?",\n":",")}return U.length=f,T.length=f,i+=e?"\n"+t+"]":"]"}(r,n,e,o):r&&"object"===(void 0===r?"undefined":t(r))?A(r,n,e,o):void 0}function A(r,n,e,t){var o=e?t+e:void 0,i=!0,f=e?"{\n":"{";if("function"==typeof r.toJSON)return C(r.toJSON(),n,e);if(j(r))return k(r,n,e,t);var u=U.length;for(var a in U[u]=r,r)if(r.hasOwnProperty(a)){var c="function"==typeof n?n.call(r,a,r[a]):r[a];B(a,c,n)&&(i?i=!1:f+=e?",\n":",",f+=e?o+'"'+a+'": ':'"'+a+'":',T[u]=a,f+=D(c,n,e,o))}return U.length=u,T.length=u,f+=e?"\n"+t+"}":"}"}function j(r){return-1!==U.indexOf(r)}function k(r,n,t,o){if(!e().circularRefs)throw new Error('Circular reference at "'+s(T)+'"');var i=U.indexOf(r);return A({$ref:s(T.slice(0,i))},n,t,o)}function B(r,n,e){return void 0!==n&&"function"!=typeof n&&(!Array.isArray(e)||function(r,n){for(var e=0;e<r.length;e++)if(r[e]==n)return!0;return!1}(e,r))}function $(r,n){for(var e="";n-- >0;)e+=r;return e}r.config=e,r.parse=function(r,n){y=0,b=(p=r).charAt(0),g="",m=v.NULL,I=[],w=[],N();var e=O();if(""!==g)throw M("Unexpected characters");return n?function(r,n){return a({"":r},"",r,n)}(e,n):e},r.stringify=C,r.LosslessNumber=f,Object.defineProperty(r,"__esModule",{value:!0})});
//# sourceMappingURL=lossless-json.js.map
